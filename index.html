// index.js
// Simple Inventory Management System
// Ready to deploy on Railway

const express = require('express');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Database (SQLite works well on Railway for simple apps)
const db = new sqlite3.Database('./inventory.db');

// Create table if it doesn't exist
db.serialize(() => {
  db.run(`
    CREATE TABLE IF NOT EXISTS inventory (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT NOT NULL,
      quantity INTEGER NOT NULL,
      location TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  `);
});

// Routes
app.get('/', (req, res) => {
  res.send(`
    <h1>Inventory System</h1>
    <form method="POST" action="/add">
      <input name="name" placeholder="Item name" required />
      <input name="quantity" type="number" placeholder="Quantity" required />
      <input name="location" placeholder="Location" />
      <button type="submit">Add Item</button>
    </form>
    <hr />
    <a href="/inventory">View Inventory</a>
  `);
});

app.post('/add', (req, res) => {
  const { name, quantity, location } = req.body;
  db.run(
    'INSERT INTO inventory (name, quantity, location) VALUES (?, ?, ?)',
    [name, quantity, location],
    () => res.redirect('/inventory')
  );
});

app.get('/inventory', (req, res) => {
  db.all('SELECT * FROM inventory ORDER BY created_at DESC', (err, rows) => {
    if (err) return res.status(500).send(err.message);

    let html = '<h1>Current Inventory</h1><ul>';
    rows.forEach(item => {
      html += `<li>${item.name} – Qty: ${item.quantity} – ${item.location || 'N/A'}</li>`;
    });
    html += '</ul><a href="/">Back</a>';

    res.send(html);
  });
});

// API endpoint (optional, for future frontend)
app.get('/api/inventory', (req, res) => {
  db.all('SELECT * FROM inventory', (err, rows) => {
    if (err) return res.status(500).json({ error: err.message });
    res.json(rows);
  });
});

// Start server
app.listen(PORT, () => {
  console.log(`Inventory app running on port ${PORT}`);
});

/*
========================
package.json (REQUIRED)
========================
Create a package.json file with this content:

{
  "name": "inventory-system",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "sqlite3": "^5.1.6"
  }
}

========================
HOW TO DEPLOY TO RAILWAY
========================
1. Create a new GitHub repository
2. Add index.js and package.json
3. Push to GitHub
4. Go to https://railway.app
5. New Project → Deploy from GitHub Repo
6. Railway will auto-detect Node.js and deploy

This is a basic starter system you can expand later
(authentication, roles, edit/delete, reports, etc.)
*/

  
